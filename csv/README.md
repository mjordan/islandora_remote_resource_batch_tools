# Islandora Remote Resource CSV Conversion Tool

Utility script to convert CSV data into files suitable for using as input to the [Islandora Remote Resource Batch](https://github.com/mjordan/islandora_solution_pack_remote_resource/tree/7.x/modules/islandora_remote_resource_batch) module.

## System requirements and installation

To install and run this tool, you will need:

* PHP 5.5.0 or higher command-line interface
* [Composer](https://getcomposer.org)

To install the tool:

1. Clone the Git repo
1. `cd islandora_remote_resource_batch_tools`
1. `cd csv`
1. `php composer.phar install` (or equivalent on your system, e.g., `./composer install`)

## Running the tool

Running `php convert_csv.php --help` will produce the following output:

```
--help
     Show the help page for this command.

--csv <argument>
     Required. Path to the input CSV file.

--output_dir <argument>
     Required. Path to the output directory.

--template <argument>
     Required. Path to the Twig template file.

--metadata_prefix <argument>
     Optional. Prefix used in CSV headers for columns containing metadata values. Also used in metadata filenames. Defaults to "dc_".
```

Running `php convert_csv.php --csv sample_data/sample.csv --output_dir /tmp/output` will produce the following output in /tmp/output:

```
/tmp/output/
├── 1.DC.xml
├── 1.TN.jpg
├── 1.txt
├── 2.DC.xml
├── 2.TN.jpg
└── 2.txt
```

This output can then be loaded into Islandora using the [Islandora Remote Resource Batch](https://github.com/mjordan/islandora_solution_pack_remote_resource/tree/7.x/modules/islandora_remote_resource_batch) module.

## The CSV file

This tool comes with a sample CSV file, and accompanying sample thumbnails:

```
ID,OBJ,dc_title,dc_description,TN
1,http://digital.lib.sfu.ca/vanpunk-267/doa-vktms,"D.O.A. VKTMS","Poster for show at Old Waldorf 444 Battery Street, San Francisco, CA, USA.",1.jpg
2,http://digital.lib.sfu.ca/vanpunk-276/1981-hard-core-tour,"1981 Hard Core Tour","Poster for show at Marble Bar 306 W. Franklin St, Baltimore, MD, USA.",2.jpg
```

### Required columns

Your CSV file must contain an `ID` column and an `OBJ` column:

* The 'ID' column contains a uniqe ID within the CSV file for the row. Can be simple incremented number, for example.
* The 'OBJ' columm contains the URL for the remote resource.

### Optional columns

The remaining columns contain either metadata values that will be inserted into a DC or MODS template, or filenames of additional datastreams you want to load, such as thumbnails.

* Headings for columns that contain values to be inserted into the metadata template should have a "metadata prefix". This defaults to `dc_`.
* Headings for columns that contain filenames should be datastream IDs. The most common will be 'TN'. The values for these columns are simple filenames. The files they name must be in the same directory as the CSV file.

## The metadata template

Metadata files describing your remote resources are generated by interpolating the values in your CSV file into a [Twig](https://twig.symfony.com/) template. This tool comes with a basic DC template, which looks like this:

```xml
<oai_dc:dc xmlns:oai_dc="http://www.openarchives.org/OAI/2.0/oai_dc/"
xmlns:dc="http://purl.org/dc/elements/1.1/"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/oai_dc/ http://www.openarchives.org/OAI/2.0/oai_dc.xsd">
  {% if dc_title %}
    <dc:title>{{ dc_title }}</dc:title>
  {% endif %}

  {% if dc_identifier %}
    <dc:identifer>{{ dc_identifier }}</dc:identifier>
  {% endif %}

  <!- Other elements omitted from this example. -->

</oai_dc:dc>
``` 

Variables in the template should correspond with columns in the CSV file and should begin wth the value definedin the `--metadata_prefix` option.

## Maintainer

* [Mark Jordan](https://github.com/mjordan)

## Development and feedback

See the CONTRIBUTING.md in [Islandora Remote Resource Solution Pack](https://github.com/mjordan/islandora_solution_pack_remote_resource).

## License

* [GPLv3](http://www.gnu.org/licenses/gpl-3.0.txt)
